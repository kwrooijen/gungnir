<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>Form</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="highlight/solarized-light.css" /><script type="text/javascript" src="highlight/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a> with <a href="https://github.com/xsc/codox-theme-rdash">RDash UI</a> theme</h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Gungnir</span> <span class="project-version">0.0.1-SNAPSHOT</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1 "><a href="README.html"><div class="inner"><span>Gungnir</span></div></a></li><li class="depth-1 "><a href="guide.html"><div class="inner"><span>Guide</span></div></a></li><li class="depth-1 "><a href="database.html"><div class="inner"><span>Database</span></div></a></li><li class="depth-1 "><a href="migrations.html"><div class="inner"><span>Migrations</span></div></a></li><li class="depth-1 "><a href="model.html"><div class="inner"><span>Model</span></div></a></li><li class="depth-1 "><a href="changeset.html"><div class="inner"><span>Changeset</span></div></a></li><li class="depth-1 "><a href="query.html"><div class="inner"><span>Query</span></div></a></li><li class="depth-1 "><a href="ui.html"><div class="inner"><span>UI</span></div></a></li><li class="depth-1  current"><a href="form.html"><div class="inner"><span>Form</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>gungnir</span></div></div></li><li class="depth-2 branch"><a href="gungnir.changeset.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>changeset</span></div></a></li><li class="depth-2"><a href="gungnir.database.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>database</span></div></a></li><li class="depth-3"><a href="gungnir.database.builder.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>builder</span></div></a></li><li class="depth-2 branch"><a href="gungnir.decode.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>decode</span></div></a></li><li class="depth-2 branch"><a href="gungnir.factory.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>factory</span></div></a></li><li class="depth-2 branch"><a href="gungnir.field.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>field</span></div></a></li><li class="depth-2 branch"><a href="gungnir.model.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>model</span></div></a></li><li class="depth-2 branch"><a href="gungnir.query.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>query</span></div></a></li><li class="depth-2 branch"><a href="gungnir.record.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>record</span></div></a></li><li class="depth-2 branch"><a href="gungnir.spec.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>spec</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></div></li><li class="depth-3"><a href="gungnir.util.malli.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>malli</span></div></a></li></ul></div><div class="document" id="content"><div class="doc"><div class="markdown"><h1><a href="#form" name="form"></a>Form</h1>
<p>Gungnir Models and Changesets can be used for form validation. A real world example would be to have a user registration form. We can share our models with Clojure and Clojurescript.</p>
<h2><a href="#user-model-password-match-validation" name="user-model-password-match-validation"></a>User Model + password match validation</h2>
<p>A basic model we can use for both frontend validation and before save validation.</p>
<pre><code class="clojure">(gungnir.model/register!
 {:user
  [:map
   [:user/id {:primary-key true} uuid?]
   [:user/email
    [:re {:error/message "Invalid email"} #".+@.+\..+"]]
   [:user/password {:before-save [:bcrypt]} [:string {:min 6}]]
   [:user/password-confirmation {:virtual true} [:string {:min 6}]]]})

(defn password-match? [m]
  (= (:user/password m)
     (:user/password-confirmation m)))

(defmethod gungnir.model/validator :register/password-match? [_]
  {:validator/key :user/password-confirmation
   :validator/fn password-match?
   :validator/message "Passwords don't match"})
</code></pre>
<h2><a href="#clojurescript-form" name="clojurescript-form"></a>Clojurescript form</h2>
<p>In this example we create a form using Hiccup syntax. This is a very simplified example with no styling. The following points are important in this example:</p>
<ul>
  <li>
  <p>Add the <code>:data-gungnir-form</code> property to the form with the key <code>:register</code>.</p></li>
  <li>
  <p>Next we add labels to each input field with the <code>.gungnir-error</code> class.</p></li>
</ul>
<pre><code class="clojure">;; Simplified form with no styling
[:form
 {:data-gungnir-form :register}

 [:div
  [:label.gungnir-error {:for :user/email}]
  [:input {:name :user/email}]]

 [:div
  [:label.gungnir-error {:for :user/password}]
  [:input {:name :user/password}]]

 [:div
  [:label.gungnir-error {:for :user/password-confirmation}]
  [:input {:name :user/password-confirmation}]]]
</code></pre>
<h2><a href="#clojurescript-validation-handler" name="clojurescript-validation-handler"></a>Clojurescript validation handler</h2>
<p>Next we can handle the validation through the <code>gungnir.ui.form/handle-validation</code> multimethod. This handler matches on the form key we defined (<code>:register</code>). And expect a map to be returned. If that map contains a <code>:changeset/errors</code> key which is not <code>nil</code>, it will inject the error messages in the proper labels.</p>
<pre><code class="clojure">(defmethod gungnir.ui.form/handle-validation :register [_ params]
  (-&gt; params
      (gungnir.changeset/cast :user)
      (gungnir.changeset/create [:register/password-match?])))
</code></pre>
<p>After the page has loaded, you will need to initialize Gungnirâ€™s form validation.</p>
<pre><code class="clojure">(gungnir.ui.form/init)
</code></pre>
<p>The final result, with some styling.</p>
<p><img src="https://raw.githubusercontent.com/kwrooijen/gungnir.ui/master/assets/form-validation.gif" alt="form-validation" /></p>
<hr />
<div class="footer-navigation">
<span>Previous: <a href="https://kwrooijen.github.io/gungnir/ui.html">ui</a></span>
</div></div></div></div></body></html>