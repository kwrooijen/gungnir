<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>Gungnir</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="highlight/solarized-light.css" /><script type="text/javascript" src="highlight/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a> with <a href="https://github.com/xsc/codox-theme-rdash">RDash UI</a> theme</h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Gungnir</span> <span class="project-version">0.0.1-SNAPSHOT</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1  current"><a href="README.html"><div class="inner"><span>Gungnir</span></div></a></li><li class="depth-1 "><a href="guide.html"><div class="inner"><span>Guide</span></div></a></li><li class="depth-1 "><a href="database.html"><div class="inner"><span>Database</span></div></a></li><li class="depth-1 "><a href="migrations.html"><div class="inner"><span>Migrations</span></div></a></li><li class="depth-1 "><a href="model.html"><div class="inner"><span>Model</span></div></a></li><li class="depth-1 "><a href="changeset.html"><div class="inner"><span>Changeset</span></div></a></li><li class="depth-1 "><a href="query.html"><div class="inner"><span>Query</span></div></a></li><li class="depth-1 "><a href="transactions.html"><div class="inner"><span>Transactions</span></div></a></li><li class="depth-1 "><a href="ui.html"><div class="inner"><span>UI</span></div></a></li><li class="depth-1 "><a href="form.html"><div class="inner"><span>Form</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>gungnir</span></div></div></li><li class="depth-2 branch"><a href="gungnir.changeset.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>changeset</span></div></a></li><li class="depth-2"><a href="gungnir.database.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>database</span></div></a></li><li class="depth-3"><a href="gungnir.database.builder.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>builder</span></div></a></li><li class="depth-2 branch"><a href="gungnir.decode.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>decode</span></div></a></li><li class="depth-2 branch"><a href="gungnir.factory.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>factory</span></div></a></li><li class="depth-2 branch"><a href="gungnir.field.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>field</span></div></a></li><li class="depth-2 branch"><a href="gungnir.migration.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>migration</span></div></a></li><li class="depth-2 branch"><a href="gungnir.model.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>model</span></div></a></li><li class="depth-2 branch"><a href="gungnir.query.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>query</span></div></a></li><li class="depth-2 branch"><a href="gungnir.record.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>record</span></div></a></li><li class="depth-2 branch"><a href="gungnir.spec.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>spec</span></div></a></li><li class="depth-2 branch"><a href="gungnir.transaction.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>transaction</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></div></li><li class="depth-3"><a href="gungnir.util.malli.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>malli</span></div></a></li></ul></div><div class="document" id="content"><div class="doc"><div class="markdown"><h1><a href="#gungnir" id="gungnir"></a>Gungnir</h1>
<p>A fully featured, data-driven database library for Clojure.</p>
<p><a href="https://travis-ci.org/kwrooijen/gungnir"><img src="https://travis-ci.org/kwrooijen/gungnir.svg?branch=master" alt="Build Status" /></a> <a href="https://codecov.io/gh/kwrooijen/gungnir"><img src="https://codecov.io/gh/kwrooijen/gungnir/branch/master/graph/badge.svg" alt="codecov" /></a> <a href="https://versions.deps.co/kwrooijen/gungnir"><img src="https://versions.deps.co/kwrooijen/gungnir/status.svg" alt="Dependencies Status" /></a> <a href="https://clojars.org/kwrooijen/gungnir"><img src="https://img.shields.io/clojars/v/gungnir.svg" alt="Clojars Project" /></a> <a href="https://clojurians.slack.com/messages/gungnir/"><img src="https://img.shields.io/badge/clojurians-gungnir-blue.svg?logo=slack" alt="Slack" /></a></p>
<blockquote>
<p>It is said that Gungnir could strike any target, regardless of the wielder’s skill.</p>
<p>- Developer, speaking to the database admin.</p>
</blockquote>
<p><a href="https://kwrooijen.github.io/gungnir/guide.html">Read the guide</a></p>
<p><a href="https://www.youtube.com/watch?v=9Sr_-Vk9wBw">Dutch Clojure Meetup - Gungnir</a></p>
<pre><code class="language-clojure">(gungnir.database/make-datasource!
  {:adapter       "postgresql"
   :username      "postgres"
   :password      "postgres"
   :database-name "postgres"
   :server-name   "localhost"
   :port-number   5432})

(def user-model
  [:map
   [:user/id {:primary-key true} uuid?]
   [:user/email {:before-save [:string/lower-case]
                 :before-read [:string/lower-case]}
    [:re {:error/message "Invalid email"} #".+@.+\..+"]]
   [:user/password {:before-save [:bcrypt]} [:string {:min 6}]]
   [:user/password-confirmation {:virtual true} [:string {:min 6}]]
   [:user/created-at {:auto true} inst?]
   [:user/updated-at {:auto true} inst?]])

(gungnir.model/register!
 {:user user-model})

(defn password-match? [m]
  (= (:user/password m)
     (:user/password-confirmation m)))

(defmethod gungnir.model/validator :user/password-match? [_]
  {:validator/key :user/password-confirmation
   :validator/fn password-match?
   :validator/message "Passwords don't match"})

(defmethod gungnir.model/before-save :bcrypt [_k v]
  (buddy.hashers/derive v))

(defn attempt-register-user [request]
  (-&gt; (:form-params request)
      (gungnir.changeset/cast :user)
      (gungnir.changeset/create [:user/password-match?])
      (gungnir.query/save!)))

(comment
  (gungnir.query/find-by! :user/email "some@email.com") ;; =&gt; {:user/email "some@email.com",,,}
  (-&gt; (gungnir.query/limit 5)
      (gungnir.query/select :user/id :user/email)
      (gungnir.query/all! :user)) ;; =&gt; [{:user/email "..." :user/id "..."},,,]
  )
</code></pre>
<h2><a href="#installation" id="installation"></a>Installation</h2>
<p>Gungnir is still in its design phase and can result in breaking changes while on the SNAPSHOT version. Any breaking changes will be reflected in the updated documentation.</p>
<p>Add the following dependencies to your <code>project.clj</code></p>
<h3><a href="#versions" id="versions"></a>Versions</h3>
<ul>
<li><a href="http://repo.clojars.org/kwrooijen/gungnir/0.0.1-SNAPSHOT/">gungnir versions</a></li>
<li><a href="http://repo.clojars.org/kwrooijen/gungnir.ui/0.0.1-SNAPSHOT/">gungnir.ui versions</a></li>
</ul>
<pre><code class="language-clojure">:dependencies [[kwrooijen/gungnir "0.0.1-xxxxxxxx.yyyyyy-z"]
               ;; Optionally for frontend validation
               [kwrooijen/gungnir.ui "0.0.1-xxxxxxxx.yyyyyy-z"]
               ,,,]
</code></pre>
<h2><a href="#rationale" id="rationale"></a>Rationale</h2>
<h3><a href="#plug-play-setup-with-quality-of-life" id="plug-play-setup-with-quality-of-life"></a>Plug &amp; Play setup with quality of life</h3>
<p>The Clojure community tends to lean towards the “pick the libraries that you need” method rather than using a “framework” when building an application. This can make it challenging for new users. Once you’re familiar with the Clojure ecosystem you’ll know which libraries you prefer and create your own setup. And that’s exactly what I’ve done.</p>
<p>If you want complete control over your database stack, then this is probably not for you. If you’re a beginner and are overwhelmed with all the necessary libraries and configuration, or if you’re looking for a Clojure database library that aims to provide a quality of life experience similar to Ruby’s ActiveRecord or Elixir’s Ecto, then stick around.</p>
<h3><a href="#data-driven" id="data-driven"></a>Data Driven</h3>
<p>I cannot stress this enough, I really dislike macros. Clojure and a large part of it’s community have taught me the beauty of writing data driven code. With great libraries such as HoneySQL, Hiccup, Integrant, Reitit, Malli, I think this is the Golden age of Data Driven Clojure. I never want to see macros in my API again.</p>
<h2><a href="#features" id="features"></a>Features</h2>
<h3><a href="#plug-play" id="plug-play"></a>Plug &amp; Play™</h3>
<p>Include Gungnir in your project, and off you go! Gungnir includes everything for your database needs.</p>
<ul>
<li><a href="https://github.com/seancorfield/next-jdbc">next-jdbc</a></li>
<li><a href="https://github.com/brettwooldridge/HikariCP">hikari-cp</a></li>
<li><a href="https://github.com/seancorfield/honeysql">HoneySQL</a></li>
<li><a href="https://github.com/metosin/malli">Malli</a></li>
<li><a href="https://github.com/weavejester/ragtime">Ragtime</a></li>
</ul>
<h3><a href="#models" id="models"></a>Models</h3>
<p>Gungnir uses models to provide data validation and seamless translation between Clojure and SQL. <a href="https://kwrooijen.github.io/gungnir/model.html">Read more</a></p>
<h3><a href="#changesets" id="changesets"></a>Changesets</h3>
<p>Inspired by Elixir Ecto’s Changesets. Validate your data before inserting or updating it in your database. View the actual changes being made, and aggregate any error messages. <a href="https://kwrooijen.github.io/gungnir/changeset.html">Read more</a></p>
<h3><a href="#querying-extension-to-honeysql" id="querying-extension-to-honeysql"></a>Querying &amp; Extension to HoneySQL</h3>
<p>Gungnir isn’t here to reinvent the wheel. Even though we have an interface for querying the database, we can still make use of HoneySQL syntax. This allows us to expand our queries, or write more complex ones for the edge cases. <a href="https://kwrooijen.github.io/gungnir/query.html">Read more</a></p>
<h3><a href="#migrations" id="migrations"></a>Migrations</h3>
<p>Define your migrations using Clojure data structures and extend them as needed. You can also fallback to raw SQL if necessary. <a href="https://kwrooijen.github.io/gungnir/migrations.html">Read more</a></p>
<h3><a href="#relational-mapping" id="relational-mapping"></a>Relational mapping</h3>
<p>Relations are easily accessed with Gungnir. Records with relations will have access to <code>relational atoms</code> which can be dereffed to query any related rows. <a href="https://kwrooijen.github.io/gungnir/model.html#model-relation-definitions">Read more</a>, <a href="https://kwrooijen.github.io/gungnir/query.html#querying-relations">and more</a></p>
<h3><a href="#frontend-validation" id="frontend-validation"></a>Frontend validation</h3>
<p>Gungnir also provides an extra package, <a href="https://github.com/kwrooijen/gungnir.ui">gungnir.ui</a>. Which provides some validation in the frontend. <a href="https://kwrooijen.github.io/gungnir/ui.html">Read more</a></p>
<h2><a href="#resources" id="resources"></a>Resources</h2>
<h3><a href="#guide" id="guide"></a>Guide</h3>
<p><a href="https://kwrooijen.github.io/gungnir/guide.html">Read the guide</a> for a full overview of all the features and how to use them.</p>
<h3><a href="#code-playground" id="code-playground"></a>Code Playground</h3>
<p>The <a href="https://github.com/kwrooijen/gungnir-playground">Gungnir code playground</a> is a repository with an “interactive tutorial”. Clone the repository and execute the code in the core namespace step by step.</p>
<h2><a href="#developing" id="developing"></a>Developing</h2>
<h3><a href="#testing" id="testing"></a>Testing</h3>
<p>In order to run the tests you’ll need <a href="https://docs.docker.com/compose/compose-file/">docker-compose</a>. Make sure this is an up to date version. Inside of the root directory you can setup the testing databases with the following command.</p>
<pre><code class="language-sh">docker-compose up -d
</code></pre>
<p>Then run the tests with <code>lein</code></p>
<pre><code class="language-sh">lein test
</code></pre>
<h2><a href="#author-license" id="author-license"></a>Author / License</h2>
<p>Released under the <a href="https://github.com/kwrooijen/gungnir/blob/master/LICENSE">MIT License</a> by <a href="https://twitter.com/kwrooijen">Kevin William van Rooijen</a>.</p>
</div></div></div></body></html>