<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>gungnir.query documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="highlight/solarized-light.css" /><script type="text/javascript" src="highlight/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a> with <a href="https://github.com/xsc/codox-theme-rdash">RDash UI</a> theme</h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Gungnir</span> <span class="project-version">0.0.2-SNAPSHOT</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1 "><a href="README.html"><div class="inner"><span>Gungnir</span></div></a></li><li class="depth-1 "><a href="guide.html"><div class="inner"><span>Guide</span></div></a></li><li class="depth-1 "><a href="database.html"><div class="inner"><span>Database</span></div></a></li><li class="depth-1 "><a href="migrations.html"><div class="inner"><span>Migrations</span></div></a></li><li class="depth-1 "><a href="model.html"><div class="inner"><span>Model</span></div></a></li><li class="depth-1 "><a href="changeset.html"><div class="inner"><span>Changeset</span></div></a></li><li class="depth-1 "><a href="query.html"><div class="inner"><span>Query</span></div></a></li><li class="depth-1 "><a href="transactions.html"><div class="inner"><span>Transactions</span></div></a></li><li class="depth-1 "><a href="ui.html"><div class="inner"><span>UI</span></div></a></li><li class="depth-1 "><a href="form.html"><div class="inner"><span>Form</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>gungnir</span></div></div></li><li class="depth-2 branch"><a href="gungnir.changeset.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>changeset</span></div></a></li><li class="depth-2"><a href="gungnir.database.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>database</span></div></a></li><li class="depth-3"><a href="gungnir.database.builder.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>builder</span></div></a></li><li class="depth-2 branch"><a href="gungnir.decode.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>decode</span></div></a></li><li class="depth-2 branch"><a href="gungnir.factory.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>factory</span></div></a></li><li class="depth-2 branch"><a href="gungnir.field.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>field</span></div></a></li><li class="depth-2 branch"><a href="gungnir.migration.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>migration</span></div></a></li><li class="depth-2 branch"><a href="gungnir.model.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>model</span></div></a></li><li class="depth-2 branch current"><a href="gungnir.query.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>query</span></div></a></li><li class="depth-2 branch"><a href="gungnir.record.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>record</span></div></a></li><li class="depth-2 branch"><a href="gungnir.spec.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>spec</span></div></a></li><li class="depth-2 branch"><a href="gungnir.transaction.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>transaction</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></div></li><li class="depth-3"><a href="gungnir.util.malli.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>malli</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="gungnir.query.html#var-add-column"><div class="inner"><span>add-column</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-add-index"><div class="inner"><span>add-index</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-alias-honey-sql-functions.21"><div class="inner"><span>alias-honey-sql-functions!</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-all"><div class="inner"><span>all</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-all.21"><div class="inner"><span>all!</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-alter-column"><div class="inner"><span>alter-column</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-alter-table"><div class="inner"><span>alter-table</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-bulk-collect-into"><div class="inner"><span>bulk-collect-into</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-columns"><div class="inner"><span>columns</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-composite"><div class="inner"><span>composite</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-create-extension"><div class="inner"><span>create-extension</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-create-materialized-view"><div class="inner"><span>create-materialized-view</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-create-table"><div class="inner"><span>create-table</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-create-table-as"><div class="inner"><span>create-table-as</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-create-view"><div class="inner"><span>create-view</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-cross-join"><div class="inner"><span>cross-join</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-delete"><div class="inner"><span>delete</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-delete.21"><div class="inner"><span>delete!</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-delete-from"><div class="inner"><span>delete-from</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-do-nothing"><div class="inner"><span>do-nothing</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-do-update-set"><div class="inner"><span>do-update-set</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-drop-column"><div class="inner"><span>drop-column</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-drop-extension"><div class="inner"><span>drop-extension</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-drop-index"><div class="inner"><span>drop-index</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-drop-materialized-view"><div class="inner"><span>drop-materialized-view</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-drop-table"><div class="inner"><span>drop-table</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-drop-view"><div class="inner"><span>drop-view</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-except"><div class="inner"><span>except</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-except-all"><div class="inner"><span>except-all</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-fetch"><div class="inner"><span>fetch</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-filter"><div class="inner"><span>filter</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-find"><div class="inner"><span>find</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-find.21"><div class="inner"><span>find!</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-find-by"><div class="inner"><span>find-by</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-find-by.21"><div class="inner"><span>find-by!</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-for"><div class="inner"><span>for</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-from"><div class="inner"><span>from</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-full-join"><div class="inner"><span>full-join</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-generic-helper-unary"><div class="inner"><span>generic-helper-unary</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-generic-helper-variadic"><div class="inner"><span>generic-helper-variadic</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-group-by"><div class="inner"><span>group-by</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-having"><div class="inner"><span>having</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-inherit-honey-sql-meta.21"><div class="inner"><span>inherit-honey-sql-meta!</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-inner-join"><div class="inner"><span>inner-join</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-insert.21"><div class="inner"><span>insert!</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-insert-into"><div class="inner"><span>insert-into</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-intersect"><div class="inner"><span>intersect</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-into"><div class="inner"><span>into</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-join"><div class="inner"><span>join</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-join-by"><div class="inner"><span>join-by</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-lateral"><div class="inner"><span>lateral</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-left-join"><div class="inner"><span>left-join</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-limit"><div class="inner"><span>limit</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-load.21"><div class="inner"><span>load!</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-lock"><div class="inner"><span>lock</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-modify-column"><div class="inner"><span>modify-column</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-offset"><div class="inner"><span>offset</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-on-conflict"><div class="inner"><span>on-conflict</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-on-constraint"><div class="inner"><span>on-constraint</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-on-duplicate-key-update"><div class="inner"><span>on-duplicate-key-update</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-order-by"><div class="inner"><span>order-by</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-outer-join"><div class="inner"><span>outer-join</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-over"><div class="inner"><span>over</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-partition-by"><div class="inner"><span>partition-by</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-refresh-materialized-view"><div class="inner"><span>refresh-materialized-view</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-rename-column"><div class="inner"><span>rename-column</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-rename-table"><div class="inner"><span>rename-table</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-replace-into"><div class="inner"><span>replace-into</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-returning"><div class="inner"><span>returning</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-right-join"><div class="inner"><span>right-join</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-save.21"><div class="inner"><span>save!</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-select"><div class="inner"><span>select</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-select-distinct"><div class="inner"><span>select-distinct</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-select-distinct-on"><div class="inner"><span>select-distinct-on</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-select-distinct-top"><div class="inner"><span>select-distinct-top</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-select-top"><div class="inner"><span>select-top</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-set"><div class="inner"><span>set</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-table"><div class="inner"><span>table</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-truncate"><div class="inner"><span>truncate</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-union"><div class="inner"><span>union</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-union-all"><div class="inner"><span>union-all</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-update"><div class="inner"><span>update</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-update.21"><div class="inner"><span>update!</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-upsert"><div class="inner"><span>upsert</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-using"><div class="inner"><span>using</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-values"><div class="inner"><span>values</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-where"><div class="inner"><span>where</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-window"><div class="inner"><span>window</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-with"><div class="inner"><span>with</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-with-columns"><div class="inner"><span>with-columns</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-with-data"><div class="inner"><span>with-data</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-with-recursive"><div class="inner"><span>with-recursive</span></div></a></li><li class="depth-1"><a href="gungnir.query.html#var-within-group"><div class="inner"><span>within-group</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">gungnir.query</h1><div class="doc"><div class="markdown"></div></div><div class="public anchor" id="var-add-column"><h3>add-column</h3><div class="usage"><code>(add-column &amp; col-elems)</code></div><div class="doc"><div class="markdown"><p>Add a single column to a table (see <code>alter-table</code>).</p>
<p>Accepts any number of SQL elements that describe a column:</p>
<p>(add-column :name <a href=":varchar 32">:varchar 32</a> <a href=":not nil">:not nil</a>)</p>
</div></div></div><div class="public anchor" id="var-add-index"><h3>add-index</h3><div class="usage"><code>(add-index &amp; index-elems)</code></div><div class="doc"><div class="markdown"><p>Like add-column, this accepts any number of SQL elements that describe a new index to be added:</p>
<p>(add-index :unique :name-key :first-name :last-name)</p>
<p>Produces: UNIQUE name_key(first_name, last_name)</p>
</div></div></div><div class="public anchor" id="var-alias-honey-sql-functions.21"><h3>alias-honey-sql-functions!</h3><h4 class="type">macro</h4><div class="usage"><code>(alias-honey-sql-functions!)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-all"><h3>all</h3><div class="usage"><code>(all ?table)</code><code>(all ?form &amp; args)</code></div><div class="doc"><div class="markdown"><p>Run a query and return a collection of records.</p>
<p>Depending on the types of arguments provided, <code>all!</code> will have different behaviors.</p>
<h2><a href="#arity-1" id="arity-1"></a>Arity 1</h2>
<p><code>?table</code> - either a <code>simple-keyword</code> representing a Gungnir which will return all rows of that table. Or it a <code>HoneySQL</code> form query the database using that.</p>
<pre><code class="language-clojure">(all :user)

(-&gt; (select :*)
    (from :user)
    (all))
</code></pre>
<h2><a href="#arity-2" id="arity-2"></a>Arity 2</h2>
<p><code>?form</code> - either a <code>HoneySQL</code> form which will extend the query. Or a <code>qualified-keyword</code> representing a model field.</p>
<p><code>args</code> - a collection of keys and values. Where the keys are <code>qualified-keywords</code> representing a model fields which will be matched with the values. If no key value pairs are provided then you must supply a model name as a <code>simple-keyword</code>.</p>
<pre><code class="language-clojure">(all :user/validated false
     :user/type :user/pro)

(-&gt; (where [:&gt; :user/date expiration-date])
    (all :user))
</code></pre>
</div></div></div><div class="public anchor" id="var-all.21"><h3>all!</h3><div class="usage"><code>(all! &amp; args)</code></div><div class="doc"><div class="markdown"><p>Same as <code>gungnir.query/all</code> but executes the query with the global datasource.</p>
</div></div></div><div class="public anchor" id="var-alter-column"><h3>alter-column</h3><div class="usage"><code>(alter-column &amp; col-elems)</code></div><div class="doc"><div class="markdown"><p>Like add-column, accepts any number of SQL elements that describe the new column definition:</p>
<p>(alter-column :name <a href=":varchar 64">:varchar 64</a> <a href=":not nil">:not nil</a>)</p>
</div></div></div><div class="public anchor" id="var-alter-table"><h3>alter-table</h3><div class="usage"><code>(alter-table table &amp; clauses)</code></div><div class="doc"><div class="markdown"><p>Alter table takes a SQL entity (the name of the table to modify) and any number of optional SQL clauses to be applied in a single statement.</p>
<p>(alter-table :foo (add-column :id :int nil))</p>
<p>If only the SQL entity is provided, the result needs to be combined with another SQL clause to modify the table.</p>
<p>(-&gt; (alter-table :foo) (add-column :id :int nil))</p>
</div></div></div><div class="public anchor" id="var-bulk-collect-into"><h3>bulk-collect-into</h3><div class="usage"><code>(bulk-collect-into varname)</code><code>(bulk-collect-into varname n)</code></div><div class="doc"><div class="markdown"><p>Accepts a variable name, optionally followed by a limit expression.</p>
</div></div></div><div class="public anchor" id="var-columns"><h3>columns</h3><div class="usage"><code>(columns &amp; cols)</code></div><div class="doc"><div class="markdown"><p>To be used with <code>insert-into</code> to specify the list of column names for the insert operation. Accepts any number of column names:</p>
<p>(-&gt; (insert-into :foo) (columns :a :b :c) (values [<a href="1 2 3">1 2 3</a> <a href="2 4 6">2 4 6</a>]))</p>
<p>Produces: INSERT INTO foo (a, b, c) VALUES (?, ?, ?), (?, ?, ?) Parameters: 1 2 3 2 4 6</p>
</div></div></div><div class="public anchor" id="var-composite"><h3>composite</h3><div class="usage"><code>(composite &amp; args)</code></div><div class="doc"><div class="markdown"><p>Accepts any number of SQL expressions and produces a composite value from them:</p>
<p>(composite :a 42)</p>
<p>Produces: (a, ?) Parameters: 42</p>
</div></div></div><div class="public anchor" id="var-create-extension"><h3>create-extension</h3><div class="usage"><code>(create-extension extension)</code><code>(create-extension extension if-not-exists)</code></div><div class="doc"><div class="markdown"><p>Accepts an extension name to create and optionally a flag to trigger IF NOT EXISTS in the SQL:</p>
<p>(create-extension :postgis) (create-extension :postgis :if-not-exists)</p>
</div></div></div><div class="public anchor" id="var-create-materialized-view"><h3>create-materialized-view</h3><div class="usage"><code>(create-materialized-view view)</code></div><div class="doc"><div class="markdown"><p>Accepts a single view name to create.</p>
<p>(-&gt; (create-materialized-view :cities) (select :*) (from :city)) (with-data true)</p>
</div></div></div><div class="public anchor" id="var-create-table"><h3>create-table</h3><div class="usage"><code>(create-table table)</code><code>(create-table table if-not-exists)</code></div><div class="doc"><div class="markdown"><p>Accepts a table name to create and optionally a flag to trigger IF NOT EXISTS in the SQL:</p>
<p>(create-table :foo) (create-table :foo :if-not-exists)</p>
</div></div></div><div class="public anchor" id="var-create-table-as"><h3>create-table-as</h3><div class="usage"><code>(create-table-as table)</code><code>(create-table-as table if-not-exists)</code></div><div class="doc"><div class="markdown"><p>Accepts a table name to create and optionally a flag to trigger IF NOT EXISTS in the SQL:</p>
<p>(create-table-as :foo) (create-table-as :foo :if-not-exists)</p>
</div></div></div><div class="public anchor" id="var-create-view"><h3>create-view</h3><div class="usage"><code>(create-view view)</code></div><div class="doc"><div class="markdown"><p>Accepts a single view name to create.</p>
<p>(-&gt; (create-view :cities) (select :*) (from :city))</p>
</div></div></div><div class="public anchor" id="var-cross-join"><h3>cross-join</h3><div class="usage"><code>(cross-join &amp; args)</code></div><div class="doc"><div class="markdown"><p>Accepts one or more CROSS JOIN expressions. Each cross join expression is specified as a table name (or a pair of table and alias):</p>
<p>(cross-join :table) (cross-join <a href=":table :t">:table :t</a>)</p>
<p>Produces: CROSS JOIN table CROSS JOIN table AS t</p>
</div></div></div><div class="public anchor" id="var-delete"><h3>delete</h3><div class="usage"><code>(delete table-coll)</code></div><div class="doc"><div class="markdown"><p>For deleting from multiple tables. Accepts a collection of table names to delete from.</p>
<p>(-&gt; (delete <a href=":films :directors">:films :directors</a>) (where <a href=":= :id 1">:= :id 1</a>))</p>
</div></div></div><div class="public anchor" id="var-delete.21"><h3>delete!</h3><div class="usage"><code>(delete! form)</code><code>(delete! form datasource)</code></div><div class="doc"><div class="markdown"><p>Delete a row from the database based on <code>record</code> which can either be a namespaced map or relational atom. The row will be deleted based on it’s <code>primary-key</code>. Return <code>true</code> on deletion. If no match is found return <code>false</code>.</p>
</div></div></div><div class="public anchor" id="var-delete-from"><h3>delete-from</h3><div class="usage"><code>(delete-from table)</code></div><div class="doc"><div class="markdown"><p>For deleting from a single table. Accepts a single table name to delete from.</p>
<p>(-&gt; (delete-from :films) (where <a href=":= :id 1">:= :id 1</a>))</p>
</div></div></div><div class="public anchor" id="var-do-nothing"><h3>do-nothing</h3><div class="usage"><code>(do-nothing)</code></div><div class="doc"><div class="markdown"><p>Called with no arguments, produces DO NOTHING</p>
</div></div></div><div class="public anchor" id="var-do-update-set"><h3>do-update-set</h3><div class="usage"><code>(do-update-set field-where-map)</code><code>(do-update-set column-value-map)</code><code>(do-update-set column* opt-where-clause)</code></div><div class="doc"><div class="markdown"><p>Accepts one or more columns to update, or a hash map of column/value pairs (like <code>set</code>), optionally followed by a <code>WHERE</code> clause. Can also accept a single hash map with a <code>:fields</code> entry specifying the columns to update and a <code>:where</code> entry specifying the <code>WHERE</code> clause.</p>
</div></div></div><div class="public anchor" id="var-drop-column"><h3>drop-column</h3><div class="usage"><code>(drop-column col)</code></div><div class="doc"><div class="markdown"><p>Takes one or more column names (use with <code>alter-table</code>).</p>
<p>Accepts an <code>IF EXISTS</code> flag (keyword or symbol) before any column names.</p>
<p>(alter-table :foo (drop-column :bar :if-exists :quux))</p>
</div></div></div><div class="public anchor" id="var-drop-extension"><h3>drop-extension</h3><div class="usage"><code>(drop-extension &amp; extensions)</code></div><div class="doc"><div class="markdown"><p>Accepts one or more extension names to drop.</p>
</div></div></div><div class="public anchor" id="var-drop-index"><h3>drop-index</h3><div class="usage"><code>(drop-index &amp; args)</code></div><div class="doc"><div class="markdown"><p>Like drop-table, accepts a single index name:</p>
<p>(drop-index :name-key)</p>
</div></div></div><div class="public anchor" id="var-drop-materialized-view"><h3>drop-materialized-view</h3><div class="usage"><code>(drop-materialized-view &amp; views)</code></div><div class="doc"><div class="markdown"><p>Accepts one or more materialied view names to drop.</p>
</div></div></div><div class="public anchor" id="var-drop-table"><h3>drop-table</h3><div class="usage"><code>(drop-table &amp; tables)</code></div><div class="doc"><div class="markdown"><p>Accepts one or more table names to drop.</p>
<p>(drop-table :foo)</p>
</div></div></div><div class="public anchor" id="var-drop-view"><h3>drop-view</h3><div class="usage"><code>(drop-view &amp; views)</code></div><div class="doc"><div class="markdown"><p>Accepts one or more view names to drop.</p>
</div></div></div><div class="public anchor" id="var-except"><h3>except</h3><div class="usage"><code>(except &amp; clauses)</code></div><div class="doc"><div class="markdown"><p>Accepts any number of SQL clauses (queries) on which to perform a set except.</p>
</div></div></div><div class="public anchor" id="var-except-all"><h3>except-all</h3><div class="usage"><code>(except-all &amp; clauses)</code></div><div class="doc"><div class="markdown"><p>Accepts any number of SQL clauses (queries) on which to perform a set except all.</p>
</div></div></div><div class="public anchor" id="var-fetch"><h3>fetch</h3><div class="usage"><code>(fetch limit)</code></div><div class="doc"><div class="markdown"><p>Accepts a single SQL expression:</p>
<p>(fetch 10)</p>
<p>Produces: FETCH ? ONLY Parameters: 10</p>
</div></div></div><div class="public anchor" id="var-filter"><h3>filter</h3><div class="usage"><code>(filter expr1 clause1 &amp; more)</code></div><div class="doc"><div class="markdown"><p>Accepts alternating expressions and clauses and produces a FILTER expression:</p>
<p>(filter :%count.* (where :&gt; i 5))</p>
<p>Produces: COUNT(*) FILTER (WHERE i &gt; ?) Parameters: 5</p>
</div></div></div><div class="public anchor" id="var-find"><h3>find</h3><div class="usage"><code>(find form)</code><code>(find model-key primary-key-value)</code><code>(find form model-key primary-key-value)</code></div><div class="doc"><div class="markdown"><p>Run a query and return a single record or nil.</p>
<p>Depending on the types of arguments provided, <code>find</code> will have different behaviors.</p>
<h2><a href="#arity-1" id="arity-1"></a>Arity 1</h2>
<p>Use <code>form</code> to query the database and return a single record or nil. Will not find a record by it’s primary-key.</p>
<p><code>form</code> - HoneySQL form which will be used to query the database.</p>
<pre><code class="language-clojure">(-&gt; (select :*)
    (from :user)
    (where [:= :user/id user-id])
    (find))
</code></pre>
<h2><a href="#arity-2" id="arity-2"></a>Arity 2</h2>
<p>Find a record by it’s primary-key from the table represented by the <code>model-key</code>.</p>
<p><code>model-key</code> - Model key which will identify which table to read from.</p>
<p><code>primary-key-value</code> - The value of the primary key to match with.</p>
<pre><code class="language-clojure">(find :user user-id)
</code></pre>
<h2><a href="#arity-3" id="arity-3"></a>Arity 3</h2>
<p>Find a record by it’s primary-key from the table represented by the <code>model-key</code>. Extended with the HoneySQL <code>form</code>.</p>
<p><code>form</code> - HoneySQL form which will be used to query the database.</p>
<p><code>model-key</code> - Model key which will identify which table to read from.</p>
<p><code>primary-key-value</code> - The value of the primary key to match with.</p>
<p>Find a single record by its <code>primary-key-value</code> from <code>table</code>. Optionally extend the query using a HoneySQL <code>form</code>.</p>
<pre><code class="language-clojure">(-&gt; (select :user/email)
    (where [:= :user/active false])
    (find :user user-id))
</code></pre>
</div></div></div><div class="public anchor" id="var-find.21"><h3>find!</h3><div class="usage"><code>(find! &amp; args)</code></div><div class="doc"><div class="markdown"><p>Same as <code>gungnir.query/find</code> but executes the query with the global datasource.</p>
</div></div></div><div class="public anchor" id="var-find-by"><h3>find-by</h3><div class="usage"><code>(find-by ?form &amp; args)</code></div><div class="doc"><div class="markdown"><p>Run a query and return a single record or nil, based on matching keys and values.</p>
<pre><code class="language-clojure">(find-by :user/email "user@test.com"
        :user/validated true)
</code></pre>
<p>Optionally extend the queries using HoneySQL</p>
<pre><code class="language-clojure">(-&gt; (select :user/username)
    (find-by :user/email "user@test.com"
             :user/validated true))
</code></pre>
</div></div></div><div class="public anchor" id="var-find-by.21"><h3>find-by!</h3><div class="usage"><code>(find-by! &amp; args)</code></div><div class="doc"><div class="markdown"><p>Same as <code>gungnir.query/find-by</code> but executes the query with the global datasource.</p>
</div></div></div><div class="public anchor" id="var-for"><h3>for</h3><div class="usage"><code>(for lock-strength table* qualifier*)</code></div><div class="doc"><div class="markdown"><p>Accepts a lock strength, optionally followed by one or more table names, optionally followed by a qualifier.</p>
</div></div></div><div class="public anchor" id="var-from"><h3>from</h3><div class="usage"><code>(from &amp; tables)</code></div><div class="doc"><div class="markdown"><p>Accepts one or more table names, or table/alias pairs.</p>
<p>(-&gt; (select :*) (from <a href=":foo :bar">:foo :bar</a>))</p>
<p>Produces: SELECT * FROM foo AS bar</p>
</div></div></div><div class="public anchor" id="var-full-join"><h3>full-join</h3><div class="usage"><code>(full-join &amp; args)</code></div><div class="doc"><div class="markdown"><p>Accepts one or more FULL JOIN expressions. Each join expression is specified as a pair of arguments, where the first one is the table name (or a pair of table and alias) and the second one is the join condition:</p>
<p>(full-join :table <a href=":= :foo.id :table.foo_id">:= :foo.id :table.foo_id</a>) (full-join <a href=":table :t">:table :t</a> <a href=":= :foo.id :t.foo_id">:= :foo.id :t.foo_id</a>)</p>
<p>Produces: FULL JOIN table ON foo.id = table.foo_id FULL JOIN table AS t ON foo.id = t.foo_id</p>
</div></div></div><div class="public anchor" id="var-generic-helper-unary"><h3>generic-helper-unary</h3><div class="usage"><code>(generic-helper-unary k args)</code></div><div class="doc"><div class="markdown"><p>Clauses that accept only a single item can be implemented using this helper, as:</p>
<p>(defn my-helper <a href="&amp; args">&amp; args</a>(generic-helper-unary :my-clause args))</p>
<p>Even though your helper is designed for clauses that accept only a single item, you should still define it as variadic, because that is the convention all helpers use here.</p>
</div></div></div><div class="public anchor" id="var-generic-helper-variadic"><h3>generic-helper-variadic</h3><div class="usage"><code>(generic-helper-variadic k args)</code></div><div class="doc"><div class="markdown"><p>Most clauses that accept a sequence of items can be implemented using this helper, as:</p>
<p>(defn my-helper <a href="&amp; args">&amp; args</a>(generic-helper-variadic :my-clause args))</p>
</div></div></div><div class="public anchor" id="var-group-by"><h3>group-by</h3><div class="usage"><code>(group-by &amp; args)</code></div><div class="doc"><div class="markdown"><p>Accepts one or more SQL expressions to group by.</p>
<p>(group-by :foo :bar) (group-by <a href=":date :baz">:date :baz</a>)</p>
<p>Produces: GROUP BY foo, bar GROUP BY DATE(baz)</p>
</div></div></div><div class="public anchor" id="var-having"><h3>having</h3><div class="usage"><code>(having &amp; exprs)</code></div><div class="doc"><div class="markdown"><p>Like <code>where</code>, accepts one or more SQL expressions (conditions) and combines them with AND (by default):</p>
<p>(having <a href=":&gt; :count 0">:&gt; :count 0</a> <a href=":&lt;&gt; :name nil">:&lt;&gt; :name nil</a>) or: (having :and <a href=":&gt; :count 0">:&gt; :count 0</a> <a href=":&lt;&gt; :name nil">:&lt;&gt; :name nil</a>)</p>
<p>Produces: HAVING (count &gt; ?) AND (name IS NOT NULL) Parameters: 0</p>
<p>(having :&gt; :count 0)</p>
<p>Produces: HAVING count &gt; ? Parameters: 0</p>
<p>(having :or <a href=":&gt; :count 0">:&gt; :count 0</a> <a href=":= :name &quot;&quot;">:= :name ""</a>)</p>
<p>Produces: HAVING (count &gt; ?) OR (name = ?) Parameters: 0 ""</p>
</div></div></div><div class="public anchor" id="var-inherit-honey-sql-meta.21"><h3>inherit-honey-sql-meta!</h3><h4 class="type">macro</h4><div class="usage"><code>(inherit-honey-sql-meta!)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-inner-join"><h3>inner-join</h3><div class="usage"><code>(inner-join &amp; args)</code></div><div class="doc"><div class="markdown"><p>An alternative name to <code>join</code>, this accepts one or more INNER JOIN expressions. Each join expression is specified as a pair of arguments, where the first one is the table name (or a pair of table and alias) and the second one is the join condition:</p>
<p>(inner-join :table <a href=":= :foo.id :table.foo_id">:= :foo.id :table.foo_id</a>) (inner-join <a href=":table :t">:table :t</a> <a href=":= :foo.id :t.foo_id">:= :foo.id :t.foo_id</a>)</p>
<p>Produces: INNER JOIN table ON foo.id = table.foo_id INNER JOIN table AS t ON foo.id = t.foo_id</p>
</div></div></div><div class="public anchor" id="var-insert.21"><h3>insert!</h3><div class="usage"><code>(insert! changeset)</code><code>(insert! changeset datasource)</code></div><div class="doc"><div class="markdown"><p>Insert the value of <code>:changeset/result</code> in <code>changeset</code>.</p>
<p>If <code>:changeset/errors</code> is not <code>nil</code> this function will have <strong>no</strong> side effects. Instead it will return the changeset as is.</p>
<p>If during insertion an error occurs, the changeset will be returned with the errors inserted in the <code>:changeset/errors</code> key.</p>
</div></div></div><div class="public anchor" id="var-insert-into"><h3>insert-into</h3><div class="usage"><code>(insert-into table)</code><code>(insert-into table cols)</code><code>(insert-into table statement)</code><code>(insert-into table cols statement)</code></div><div class="doc"><div class="markdown"><p>Accepts a table name or a table/alias pair. That can optionally be followed by a collection of column names. That can optionally be followed by a (select) statement clause.</p>
<p>(insert-into :table) (insert-into <a href=":table :t">:table :t</a>) (insert-into :table <a href=":id :name :cost">:id :name :cost</a>) (insert-into :table (-&gt; (select :<em>) (from :other))) (insert-into <a href=":table :t">:table :t</a> <a href=":id :name :cost">:id :name :cost</a> (-&gt; (select :</em>) (from :other)))</p>
</div></div></div><div class="public anchor" id="var-intersect"><h3>intersect</h3><div class="usage"><code>(intersect &amp; clauses)</code></div><div class="doc"><div class="markdown"><p>Accepts any number of SQL clauses (queries) on which to perform a set intersection.</p>
</div></div></div><div class="public anchor" id="var-into"><h3>into</h3><div class="usage"><code>(into table)</code><code>(into table dbname)</code></div><div class="doc"><div class="markdown"><p>Accepts table name, optionally followed a database name.</p>
</div></div></div><div class="public anchor" id="var-join"><h3>join</h3><div class="usage"><code>(join &amp; args)</code></div><div class="doc"><div class="markdown"><p>Accepts one or more (INNER) JOIN expressions. Each join expression is specified as a pair of arguments, where the first one is the table name (or a pair of table and alias) and the second one is the join condition:</p>
<p>(join :table <a href=":= :foo.id :table.foo_id">:= :foo.id :table.foo_id</a>) (join <a href=":table :t">:table :t</a> <a href=":= :foo.id :t.foo_id">:= :foo.id :t.foo_id</a>)</p>
<p>Produces: INNER JOIN table ON foo.id = table.foo_id INNER JOIN table AS t ON foo.id = t.foo_id</p>
</div></div></div><div class="public anchor" id="var-join-by"><h3>join-by</h3><div class="usage"><code>(join-by &amp; args)</code></div><div class="doc"><div class="markdown"><p>Accepts a sequence of join clauses to be generated in a specific order.</p>
<p>(-&gt; (select :*) (from :foo) (join-by :left [:bar <a href=":= :foo.id :bar.id">:= :foo.id :bar.id</a>] :join [:quux <a href=":= :bar.qid :quux.id">:= :bar.qid :quux.id</a>]))</p>
<p>This produces a LEFT JOIN followed by an INNER JOIN even though the ‘natural’ order for <code>left-join</code> and <code>join</code> would be to generate the INNER JOIN first, followed by the LEFT JOIN.</p>
</div></div></div><div class="public anchor" id="var-lateral"><h3>lateral</h3><div class="usage"><code>(lateral clause-or-expression)</code></div><div class="doc"><div class="markdown"><p>Accepts a SQL clause or a SQL expression:</p>
<p>(lateral (-&gt; (select ’*) (from ’foo))) (lateral ’(calc_value bar))</p>
<p>Produces: LATERAL (SELECT * FROM foo) LATERAL CALC_VALUE(bar)</p>
</div></div></div><div class="public anchor" id="var-left-join"><h3>left-join</h3><div class="usage"><code>(left-join &amp; args)</code></div><div class="doc"><div class="markdown"><p>Accepts one or more LEFT JOIN expressions. Each join expression is specified as a pair of arguments, where the first one is the table name (or a pair of table and alias) and the second one is the join condition:</p>
<p>(left-join :table <a href=":= :foo.id :table.foo_id">:= :foo.id :table.foo_id</a>) (left-join <a href=":table :t">:table :t</a> <a href=":= :foo.id :t.foo_id">:= :foo.id :t.foo_id</a>)</p>
<p>Produces: LEFT JOIN table ON foo.id = table.foo_id LEFT JOIN table AS t ON foo.id = t.foo_id</p>
</div></div></div><div class="public anchor" id="var-limit"><h3>limit</h3><div class="usage"><code>(limit limit)</code></div><div class="doc"><div class="markdown"><p>Specific to some databases (notabley MySQL), accepts a single SQL expression:</p>
<p>(limit 40)</p>
<p>Produces: LIMIT ? Parameters: 40</p>
<p>The two-argument syntax is not supported: use <code>offset</code> instead:</p>
<p><code>LIMIT 20,10</code> is equivalent to <code>LIMIT 10 OFFSET 20</code></p>
<p>(-&gt; (limit 10) (offset 20))</p>
</div></div></div><div class="public anchor" id="var-load.21"><h3>load!</h3><div class="usage"><code>(load! record &amp; field-keys)</code></div><div class="doc"><div class="markdown"><p>Load the relations <code>field-keys</code> of <code>record</code>, but retain the structure.</p>
</div></div></div><div class="public anchor" id="var-lock"><h3>lock</h3><div class="usage"><code>(lock lock-mode)</code></div><div class="doc"><div class="markdown"><p>Intended for MySQL, this accepts a lock mode.</p>
<p>It will accept the same type of syntax as <code>for</code> even though MySQL’s <code>lock</code> clause is less powerful.</p>
</div></div></div><div class="public anchor" id="var-modify-column"><h3>modify-column</h3><div class="usage"><code>(modify-column &amp; col-elems)</code></div><div class="doc"><div class="markdown"><p>Like add-column, accepts any number of SQL elements that describe the new column definition:</p>
<p>(modify-column :name <a href=":varchar 64">:varchar 64</a> <a href=":not nil">:not nil</a>)</p>
<p>MySQL-specific, deprecated. Use <code>alter-column</code> and specify the MySQL dialect to get <code>MODIFY COLUMN</code>.</p>
</div></div></div><div class="public anchor" id="var-offset"><h3>offset</h3><div class="usage"><code>(offset offset)</code></div><div class="doc"><div class="markdown"><p>Accepts a single SQL expression:</p>
<p>(offset 10)</p>
<p>Produces: OFFSET ? Parameters: 10</p>
</div></div></div><div class="public anchor" id="var-on-conflict"><h3>on-conflict</h3><div class="usage"><code>(on-conflict column* where-clause)</code></div><div class="doc"><div class="markdown"><p>Accepts zero or more SQL entities (keywords or symbols), optionally followed by a single SQL clause (hash map).</p>
</div></div></div><div class="public anchor" id="var-on-constraint"><h3>on-constraint</h3><div class="usage"><code>(on-constraint constraint)</code></div><div class="doc"><div class="markdown"><p>Accepts a single constraint name.</p>
</div></div></div><div class="public anchor" id="var-on-duplicate-key-update"><h3>on-duplicate-key-update</h3><div class="usage"><code>(on-duplicate-key-update column-value-map)</code></div><div class="doc"><div class="markdown"><p>MySQL’s upsert facility. Accepts a hash map of column/value pairs to be updated (like <code>set</code> does).</p>
</div></div></div><div class="public anchor" id="var-order-by"><h3>order-by</h3><div class="usage"><code>(order-by &amp; args)</code></div><div class="doc"><div class="markdown"><p>Accepts one or more expressions to order by.</p>
<p>An ordering expression may be a simple column name which is assumed to be ordered <code>ASC</code>, or a pair of an expression and a direction (<code>:asc</code> or <code>:desc</code>):</p>
<p>(order-by :foo) (order-by <a href=":bar :desc">:bar :desc</a>) (order-by [<a href=":date :baz">:date :baz</a> :asc])</p>
<p>Produces: ORDER BY foo ASC ORDER BY bar DESC ORDER BY DATE(baz) ASC</p>
</div></div></div><div class="public anchor" id="var-outer-join"><h3>outer-join</h3><div class="usage"><code>(outer-join &amp; args)</code></div><div class="doc"><div class="markdown"><p>Accepts one or more OUTER JOIN expressions. Each join expression is specified as a pair of arguments, where the first one is the table name (or a pair of table and alias) and the second one is the join condition:</p>
<p>(outer-join :table <a href=":= :foo.id :table.foo_id">:= :foo.id :table.foo_id</a>) (outer-join <a href=":table :t">:table :t</a> <a href=":= :foo.id :t.foo_id">:= :foo.id :t.foo_id</a>)</p>
<p>Produces: OUTER JOIN table ON foo.id = table.foo_id OUTER JOIN table AS t ON foo.id = t.foo_id</p>
</div></div></div><div class="public anchor" id="var-over"><h3>over</h3><div class="usage"><code>(over &amp; args)</code></div><div class="doc"><div class="markdown"><p>Accepts any number of OVER clauses, each of which is a pair of an aggregate function and a window function or a triple of an aggregate function, a window function, and an alias:</p>
<p>(select :id (over [<a href=":avg :salary">:avg :salary</a>(partition-by :department)]))</p>
<p>Produces: SELECT id, AVG(salary) OVER ()PARTITION BY department)</p>
</div></div></div><div class="public anchor" id="var-partition-by"><h3>partition-by</h3><div class="usage"><code>(partition-by &amp; args)</code></div><div class="doc"><div class="markdown"><p>Accepts one or more columns or SQL expressions to partition by as part of a <code>WINDOW</code> expression.</p>
</div></div></div><div class="public anchor" id="var-refresh-materialized-view"><h3>refresh-materialized-view</h3><div class="usage"><code>(refresh-materialized-view view)</code></div><div class="doc"><div class="markdown"><p>Accepts a materialied view name to refresh.</p>
</div></div></div><div class="public anchor" id="var-rename-column"><h3>rename-column</h3><div class="usage"><code>(rename-column old-col new-col)</code></div><div class="doc"><div class="markdown"><p>Accepts two column names: the original name and the new name to which it should be renamed:</p>
<p>(rename-column :name :full-name)</p>
</div></div></div><div class="public anchor" id="var-rename-table"><h3>rename-table</h3><div class="usage"><code>(rename-table new-table)</code></div><div class="doc"><div class="markdown"><p>Accepts a single table name and, despite its name, actually means RENAME TO:</p>
<p>(alter-table :foo (rename-table :bar))</p>
<p>Produces: ALTER TABLE foo RENAME TO bar</p>
</div></div></div><div class="public anchor" id="var-replace-into"><h3>replace-into</h3><div class="usage"><code>(replace-into table)</code><code>(replace-into table cols)</code><code>(replace-into table statement)</code><code>(replace-into table cols statement)</code></div><div class="doc"><div class="markdown"><p>Accepts a table name or a table/alias pair. That can optionally be followed by a collection of column names. That can optionally be followed by a (select) statement clause.</p>
<p>The arguments are identical to insert-into. The REPLACE INTO statement is only supported by MySQL and SQLite.</p>
</div></div></div><div class="public anchor" id="var-returning"><h3>returning</h3><div class="usage"><code>(returning &amp; cols)</code></div><div class="doc"><div class="markdown"><p>Accepts any number of column names to return from an insert operation:</p>
<p>(returning :*) and (returning :a :b)</p>
<p>Produce: RETURNING * and RETURNING a, b respectively.</p>
</div></div></div><div class="public anchor" id="var-right-join"><h3>right-join</h3><div class="usage"><code>(right-join &amp; args)</code></div><div class="doc"><div class="markdown"><p>Accepts one or more RIGHT JOIN expressions. Each join expression is specified as a pair of arguments, where the first one is the table name (or a pair of table and alias) and the second one is the join condition:</p>
<p>(right-join :table <a href=":= :foo.id :table.foo_id">:= :foo.id :table.foo_id</a>) (right-join <a href=":table :t">:table :t</a> <a href=":= :foo.id :t.foo_id">:= :foo.id :t.foo_id</a>)</p>
<p>Produces: RIGHT JOIN table ON foo.id = table.foo_id RIGHT JOIN table AS t ON foo.id = t.foo_id</p>
</div></div></div><div class="public anchor" id="var-save.21"><h3>save!</h3><div class="usage"><code>(save! changeset)</code><code>(save! {:changeset/keys [result], :as changeset} datasource)</code></div><div class="doc"><div class="markdown"><p>Insert or update the value of <code>:changeset/result</code> in <code>changeset</code>. If no <code>primary-key</code> is present, the record will be inserted, otherwise the existing record will be updated based on the <code>:changeset/diff</code> fields.</p>
<p>If <code>:changeset/errors</code> is not <code>nil</code> this function will have <strong>no</strong> side effects. Instead it will return the changeset as is.</p>
<p>If during insert / update an error occurs, the changeset will be returned with the errors inserted in the <code>:changeset/errors</code> key.</p>
</div></div></div><div class="public anchor" id="var-select"><h3>select</h3><div class="usage"><code>(select &amp; exprs)</code></div><div class="doc"><div class="markdown"><p>Accepts any number of column names, or column/alias pairs, or SQL expressions (optionally aliased):</p>
<p>(select :id <a href=":foo :bar">:foo :bar</a> <a href="null">:max :quux</a>)</p>
<p>Produces: SELECT id, foo AS bar, MAX(quux)</p>
<p>The special column name :* produces * for ‘all columns’. You can also specify :t.* for ‘all columns’ from the table (or alias) t.</p>
</div></div></div><div class="public anchor" id="var-select-distinct"><h3>select-distinct</h3><div class="usage"><code>(select-distinct &amp; args)</code></div><div class="doc"><div class="markdown"><p>Like <code>select</code> but produces SELECT DISTINCT.</p>
</div></div></div><div class="public anchor" id="var-select-distinct-on"><h3>select-distinct-on</h3><div class="usage"><code>(select-distinct-on distinct-cols &amp; exprs)</code></div><div class="doc"><div class="markdown"><p>Accepts a sequence of one or more columns for the distinct clause, followed by any number of column names, or column/alias pairs, or SQL expressions (optionally aliased), as for <code>select</code>:</p>
<p>(select-distinct-on <a href=":a :b">:a :b</a> :c <a href=":d :dd">:d :dd</a>)</p>
<p>Produces: SELECT DISTINCT ON(a, b) c, d AS dd</p>
</div></div></div><div class="public anchor" id="var-select-distinct-top"><h3>select-distinct-top</h3><div class="usage"><code>(select-distinct-top &amp; args)</code></div><div class="doc"><div class="markdown"><p>Like <code>select-top</code> but produces SELECT DISTINCT TOP…</p>
</div></div></div><div class="public anchor" id="var-select-top"><h3>select-top</h3><div class="usage"><code>(select-top &amp; args)</code></div><div class="doc"><div class="markdown"><p>Accepts a TOP expression, followed by any number of column names, or column/alias pairs, or SQL expressions (optionally aliased), as for <code>select</code>. The TOP expression can be a simple numeric expression, or a sequence with a numeric expression followed by keywords (or symbols) for PERCENT and/or WITH TIES.</p>
</div></div></div><div class="public anchor" id="var-set"><h3>set</h3><div class="usage"><code>(set col-set-map)</code></div><div class="doc"><div class="markdown"><p>Accepts a hash map specifying column names and the values to be assigned to them, as part of <code>update</code>:</p>
<p>(-&gt; (update :foo) (set {:a 1 :b nil}))</p>
<p>Produces: UPDATE foo SET a = ?, b = NULL</p>
</div></div></div><div class="public anchor" id="var-table"><h3>table</h3><div class="usage"><code>(table name)</code></div><div class="doc"><div class="markdown"><p>Accepts a single table name and produces TABLE name</p>
<p>This is equivalent to: SELECT * FROM name</p>
</div></div></div><div class="public anchor" id="var-truncate"><h3>truncate</h3><div class="usage"><code>(truncate table)</code></div><div class="doc"><div class="markdown"><p>Accepts a single table name to truncate.</p>
</div></div></div><div class="public anchor" id="var-union"><h3>union</h3><div class="usage"><code>(union &amp; clauses)</code></div><div class="doc"><div class="markdown"><p>Accepts any number of SQL clauses (queries) on which to perform a set union.</p>
</div></div></div><div class="public anchor" id="var-union-all"><h3>union-all</h3><div class="usage"><code>(union-all &amp; clauses)</code></div><div class="doc"><div class="markdown"><p>Accepts any number of SQL clauses (queries) on which to perform a set union all.</p>
</div></div></div><div class="public anchor" id="var-update"><h3>update</h3><div class="usage"><code>(update table)</code></div><div class="doc"><div class="markdown"><p>Accepts either a table name or a table/alias pair.</p>
<p>(-&gt; (update :table) (set {:id 1 :cost 32.1}))</p>
</div></div></div><div class="public anchor" id="var-update.21"><h3>update!</h3><div class="usage"><code>(update! changeset)</code><code>(update! changeset datasource)</code></div><div class="doc"><div class="markdown"><p>Insert the value of <code>:changeset/result</code> in <code>changeset</code>.</p>
<p>If <code>:changeset/errors</code> is not <code>nil</code> this function will have <strong>no</strong> side effects. Instead it will return the changeset as is.</p>
<p>If during the update an error occurs, the changeset will be returned with the errors updated in the <code>:changeset/errors</code> key.</p>
</div></div></div><div class="public anchor" id="var-upsert"><h3>upsert</h3><div class="usage"><code>(upsert clause)</code><code>(upsert data clause)</code></div><div class="doc"><div class="markdown"><p>Provided purely to ease migration from nilenso/honeysql-postgres this accepts a single clause, constructed from on-conflict, do-nothing or do-update-set, and where. Any of those are optional.</p>
<p>This helper unpacks that clause and turns it into what HoneySQL 2.x expects, with any where clause being an argument to the do-update-set helper, along with the <code>:fields</code>.</p>
<p>nilenso/honeysql-postgres:</p>
<p>(-&gt; … (upsert (-&gt; (on-conflict :col) do-nothing))) (-&gt; … (upsert (-&gt; (on-conflict :col) (do-update-set :x) (where <a href=":&lt;&gt; :x nil">:&lt;&gt; :x nil</a>))))</p>
<p>HoneySQL 2.x:</p>
<p>(-&gt; … (on-conflict :col) do-nothing) (-&gt; … (on-conflict :col) (do-update-set {:fields <a href=":x">:x</a> :where <a href=":&lt;&gt; :x nil">:&lt;&gt; :x nil</a>}))</p>
<p>Alternative structure for that second one:</p>
<p>(-&gt; … (on-conflict :col) (do-update-set :x {:where <a href=":&lt;&gt; :x nil">:&lt;&gt; :x nil</a>}))</p>
</div></div></div><div class="public anchor" id="var-using"><h3>using</h3><div class="usage"><code>(using &amp; args)</code></div><div class="doc"><div class="markdown"><p>Accepts similar arguments to <code>select</code> as part of a SQL <code>USING</code> clause.</p>
</div></div></div><div class="public anchor" id="var-values"><h3>values</h3><div class="usage"><code>(values row-value-coll)</code></div><div class="doc"><div class="markdown"><p>Accepts a single argument: a collection of row values. Each row value can be either a sequence of column values or a hash map of column name/column value pairs.</p>
<p>Used with <code>insert-into</code>.</p>
<p>(-&gt; (insert-into :foo) (values <a href="{:id 1, :name &quot;John&quot;}
{:id 2, :name &quot;Fred&quot;}">{:id 1, :name “John”} {:id 2, :name “Fred”}</a>))</p>
<p>Produces: INSERT INTO foo (id, name) VALUES (?, ?), (?, ?) Parameters: 1 “John” 2 “Fred”</p>
</div></div></div><div class="public anchor" id="var-where"><h3>where</h3><div class="usage"><code>(where &amp; exprs)</code></div><div class="doc"><div class="markdown"><p>Accepts one or more SQL expressions (conditions) and combines them with AND (by default):</p>
<p>(where <a href=":= :status 0">:= :status 0</a> <a href=":&lt;&gt; :task &quot;backup&quot;">:&lt;&gt; :task “backup”</a>) or: (where :and <a href=":= :status 0">:= :status 0</a> <a href=":&lt;&gt; :task &quot;backup&quot;">:&lt;&gt; :task “backup”</a>)</p>
<p>Produces: WHERE (status = ?) AND (task &lt;&gt; ?) Parameters: 0 “backup”</p>
<p>For a single expression, the brackets can be omitted:</p>
<p>(where := :status 0) ; same as (where <a href=":= :status 0">:= :status 0</a>)</p>
<p>With multiple expressions, the conjunction may be specified as a leading symbol:</p>
<p>(where :or <a href=":= :status 0">:= :status 0</a> <a href=":= :task &quot;stop&quot;">:= :task “stop”</a>)</p>
<p>Produces: WHERE (status = 0) OR (task = ?) Parameters: 0 “stop”</p>
</div></div></div><div class="public anchor" id="var-window"><h3>window</h3><div class="usage"><code>(window &amp; args)</code></div><div class="doc"><div class="markdown"><p>Accepts a window name followed by a partition by clause.</p>
</div></div></div><div class="public anchor" id="var-with"><h3>with</h3><div class="usage"><code>(with &amp; args)</code></div><div class="doc"><div class="markdown"><p>Accepts one or more CTE definitions.</p>
<p>See the documentation for the <code>:with</code> clause.</p>
</div></div></div><div class="public anchor" id="var-with-columns"><h3>with-columns</h3><div class="usage"><code>(with-columns &amp; col-specs)</code><code>(with-columns col-spec-coll)</code></div><div class="doc"><div class="markdown"><p>Accepts any number of column descriptions. Each column description is a sequence of SQL elements that specify the name and the attributes.</p>
<p>(with-columns [:id :int <a href=":not nil">:not nil</a>] [:name <a href=":varchar 32">:varchar 32</a> <a href=":default &quot;&quot;">:default ""</a>])</p>
<p>Produces: id INT NOT NULL, name VARCHAR(32) DEFAULT ''</p>
<p>Can also accept a single argument which is a collection of column descriptions (mostly for compatibility with nilenso/honeysql-postgres which used to be needed for DDL).</p>
</div></div></div><div class="public anchor" id="var-with-data"><h3>with-data</h3><div class="usage"><code>(with-data data?)</code></div><div class="doc"><div class="markdown"><p>Accepts a Boolean determining WITH DATA vs WITH NO DATA.</p>
</div></div></div><div class="public anchor" id="var-with-recursive"><h3>with-recursive</h3><div class="usage"><code>(with-recursive &amp; args)</code></div><div class="doc"><div class="markdown"><p>Accepts one or more CTE definitions.</p>
<p>See the documentation for the <code>:with</code> clause.</p>
</div></div></div><div class="public anchor" id="var-within-group"><h3>within-group</h3><div class="usage"><code>(within-group expr1 clause1 &amp; more)</code></div><div class="doc"><div class="markdown"><p>Accepts alternating expressions and clauses and produces a WITHIN GROUP expression:</p>
<p>(within-group :%count.* (where :&gt; i 5))</p>
<p>Produces: COUNT(*) WITHIN GROUP (WHERE i &gt; ?) Parameters: 5</p>
</div></div></div></div></body></html>